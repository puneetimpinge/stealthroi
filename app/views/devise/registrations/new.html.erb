<div class="page-class">
  <header class="header" >
    <div class="container">
      <div class="row">
        <div class="col-sm-3 col-xs-9">
          <h1 class="logo" ><a href="/"><img src="/assets/logo.png"/></a></h1>
        </div>
        <div class="header-right col-sm-9 col-xs-3">
          <nav class="navigation">
            <button data-target=".navbar-collapse" data-toggle="collapse" class="navbar-toggle collapsed" type="button"> <span class="sr-only">Navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button>
            <div id="navbar" class="collapse navbar-collapse">
              <ul class="nav navbar-nav">
                
                <li><a href="/users/sign_in" class="btn-default-theme" >Login</a></li>
                <li><a href="/users/sign_up" class="btn-default-theme" >Signup</a></li>
              </ul>
            </div>
          </nav>
        </div>
      </div>
    </div>
  </header>

  <div class="modal-theme">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title" id="myModalLabel">SIGNUP</h4>
          <h5 class="error_msg" style="color:red;display:none"></h5>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="col-md-5">
              <h3>SignUp With :</h3>
              <p class="social-login">
                <a href="<%= user_omniauth_authorize_path(:facebook) %>"><img src="/assets/fb-signup.png" alt=""/></a>
                <a href="#"><img src="/assets/google-signup.png" alt=""/></a>
                <a href="#"><img src="/assets/twitter-signup.png" alt=""/></a>
              </p>
            </div>
            <div class="col-md-7">
              <h3>Register a new Account:</h3>
              <%= form_for(resource, as: resource_name, url: registration_path(resource_name)) do |f| %>
                <%= devise_error_messages! %>
                <div class="signup_box">
                  <div class=" form-group input-group input-group-lg">
                    <span class="input-group-addon" id="sizing-addon1"><img src="/assets/user.png" alt="" width="26" height="19"/></span>
                    <%= f.text_field :fname,:class=>"form-control",placeholder:"Full Name", "aria-describedby"=>"sizing-addon1",:required=>"required" %>
                  </div>
                  <div class="form-group input-group input-group-lg">
                    <span class="input-group-addon" id="sizing-addon1"><img src="/assets/email.png" alt="" width="26" height="19"/></span>
                    <%= f.email_field :email,:class=>"form-control",placeholder:"Email", "aria-describedby"=>"sizing-addon1",:required=>"required" %>
                  </div>
                  <div class=" form-group input-group input-group-lg">
                    <span class="input-group-addon" id="sizing-addon1"><img src="/assets/lock.png" alt="" width="26" height="19"/></span>
                    <%= f.password_field :password,:class=>"form-control",placeholder:"Enter Password", "aria-describedby"=>"sizing-addon1",:required=>"required" %>
                  </div>
                  <div class=" form-group input-group input-group-lg">
                    <span class="input-group-addon" id="sizing-addon1"><img src="/assets/retyp.png" alt="" width="26" height="19"/></span>
                    <%= f.password_field :password_confirmation,:class=>"form-control",placeholder:"Retype Password", "aria-describedby"=>"sizing-addon1",:required=>"required" %>
                  </div>
                  <div class=" form-group">
                    <div class="checkbox">
                      <input id="check1" type="checkbox" name="check" value="check1">
                      <label for="check1">I agree to <a href="#">terms</a></label>
                    </div>
                  </div>
                  <button class="btn-default-theme" id="next_btn" type="submit">Next</button>
                </div>

                <div class="payment_box" style="display:none">
                  <div class=" form-group input-group input-group-lg">
                    <span class="input-group-addon" id="sizing-addon1"><img src="/assets/user.png" alt="" width="26" height="19"/></span>
                    <%= f.text_field :card_name,:class=>"form-control",placeholder:"Card Name", "aria-describedby"=>"sizing-addon1" %>
                  </div>
                  <div class="form-group input-group input-group-lg">
                    <span class="input-group-addon" id="sizing-addon1"><img src="/assets/email.png" alt="" width="26" height="19"/></span>
                    <%= f.text_field :card_number,:class=>"form-control",placeholder:"Card Number", "aria-describedby"=>"sizing-addon1" %>
                  </div>
                  <div class=" form-group input-group input-group-lg">
                    <span class="input-group-addon" id="sizing-addon1"><img src="/assets/lock.png" alt="" width="26" height="19"/></span>
                    <%= f.text_field :cvv,:class=>"form-control",placeholder:"CVV", "aria-describedby"=>"sizing-addon1" %>
                  </div>
                  <div class=" form-group input-group input-group-lg">
                    <span class="input-group-addon" id="sizing-addon1"><img src="/assets/retyp.png" alt="" width="26" height="19"/></span>
                    <%= f.select :card_type, [["Visa", "visa"], ["MasterCard", "master"], ["Discover", "discover"], ["American Express", "american_express"]], :class=> "form-control" %>
                  </div>
                  <div class=" form-group input-group input-group-lg">
                    <span class="input-group-addon" id="sizing-addon1"><img src="/assets/lock.png" alt="" width="26" height="19"/></span>
                    <%= f.date_select :card_expires_on, discard_day: true, start_year: Date.today.year, end_year: (Date.today.year+10), class: "form-control", required: true %>
                  </div>
                  <%= f.hidden_field :payment_status,value: "false", class: "payment_status" %>

                  <%= f.submit 'Sign Up', class: 'btn-default-theme', id: "signup_btn" %>
                  <a href="#" id="back_btn">Back</a>
                </div>
              <%end%>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
        <a href="#home" class="back-top"><img src="/assets/backTotop.png" alt="pic"/></a>
          <p class="copy-text">Copyright Â© 2015 <span>StealthROI</span>. All rights reserved.</p>
      <p class="t-social"><a href="#"><img src="/assets/icon-facebook.png" alt="" /></a> <a href="#"><img src="/assets/icon-twitter.png" alt="" /></a> <a href="#"><img src="/assets/icon-gplus.png" alt="" /></a></p>
      </div>
  </footer>
</div>

<script>
$(function() {
  var header = $(".header");
  $(window).scroll(function(e) {
    var scroll = $(window).scrollTop();
    if (scroll >= 150) {
      header.addClass("shrink");
    }else {
      header.removeClass("shrink");
    }
  });
  $("#user_password").rules("add",{minlength: 8});
  $("#user_password_confirmation").rules("add",{minlength: 8,equalTo: "#user_password"});
});

$("#next_btn").click(function(e){
  e.preventDefault();
  e.stopPropagation();
  $($('form')[0]).valid();
  $("#user_password").rules("add",{minlength: 8});
  $("#user_password_confirmation").rules("add",{minlength: 8,equalTo: "#user_password"});

  if ($($('form')[0]).valid()){
    $(".signup_box").hide()
    $(".payment_box").show()
  }
})

  $("#back_btn").click(function(e){
    e.preventDefault();
    $(".signup_box").show()
    $(".payment_box").hide()
  })

   $("#signup_btn").click(function(e){
    e.preventDefault();
    if ($('#preview1').html() == ""){
      var opts = {
              lines: 17,
              length: 40,
              width: 22,
              radius: 60,
              corners: 1,
              rotate: 90,
              direction: 1,
              color: '#000',
              speed: 1.3,
              trail: 96,
              shadow: false,
              hwaccel: false,
              className: 'spinner',
              zIndex: 2e9,
              top: '50%',
              left: '50%'
      };
      var target = document.getElementById('preview1');
      var spinner = new Spinner(opts).spin(target);
      target.appendChild(spinner.el);

      var card_name = $(this).parent().find("#user_card_name").val();
      var card_number = $(this).parent().find("#user_card_number").val();
      var cvv = $(this).parent().find("#user_cvv").val();
      var card_type = $(this).parent().find("#user_card_type").val();
      var card_year = $(this).parent().find("#user_card_expires_on_1i").val();
      var card_month = $(this).parent().find("#user_card_expires_on_2i").val();
      var src = $(this)

      $.ajax({
        type: 'post',
        url: '/user/verify_payment',
        // async: false,
        data: 'card_name='+card_name+'&card_number='+card_number+'&cvv='+cvv+'&card_type='+card_type+'&card_year='+card_year+'&card_month='+card_month,
        success: function(e){
          if (e.status == true){
            $(".payment_status").val("true")
            target.removeChild(spinner.el);
            $(src.parent().parent()[0]).submit()
          }else{
            var msg = JSON.stringify(e.message.details) 
            $(".error_msg").html(msg).css("display","block")
            $('#signupModal').animate({scrollTop: '100px'}, 300);
            target.removeChild(spinner.el);
            setTimeout(function(){
              $('.error_msg').slideUp();
            }, 10000);
          }
        },
        error: function(){
          target.removeChild(spinner.el);
          alert('Something went wrong.')
        }
      })
    }  
  })
</script>


<style type="text/css">
  select {
    background-color: #fff;
    border: 1px solid #454545;
    border-left: 0px;
    border-radius: 0px;
    height: 80px;
    width: 100%
    }
    #user_card_expires_on_1i,#user_card_expires_on_2i{
      width: 50%;
      padding: 10px;
    }
    label.error{
      font-weight: 0;
      display: table-caption;
      width: 100%;
      padding: 0;
      margin: 0;
      font-size: 12px;
    }
    .input-group-lg label:before{
      border:none !important;
      width: 0 !important;
      height: 0 !important;
    }
</style>